<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pace Calculator</title>
<link rel="icon" href="spiderman.png" type="image/png" />

<link rel="manifest" href="./manifest.json">
<link rel="icon" href="./iplogo.png">
<link rel="apple-touch-icon" href="./iplogo.png">
<meta name="theme-color" content="#c0c0c0">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
:root{
  --bg:#c0c0c0;
  --panel:#c0c0c0;
  --border-dark:#404040;
  --border-light:#ffffff;
  --border-mid:#808080;
  --field:#ffffff;
  --track:#b0b0b0;
  --knob:#d8d8d8;
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  background:var(--bg);
  font-family:"MS Sans Serif", Tahoma, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:16px;
}

/* ✅ Home nav button (Win95 theme) */
.menu-buttons{
  position:fixed;
  top:12px;
  left:12px;
  z-index:9998; /* under modal (9999), above UI */
}
.navBtn{
  padding:8px 14px;
  font-weight:bold;
  background:var(--panel);
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
  box-shadow:1px 1px 0 #000;
  cursor:pointer;
  font-family:"MS Sans Serif", Tahoma, sans-serif;
  font-size:12px;
}
.navBtn:active{ transform:translate(1px,1px); }

.win95{
  width:min(520px,100%);
  background:var(--panel);
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
  box-shadow:1px 1px 0 #000;
}

.titlebar{
  padding:10px 12px;
  background:#a0a0a0;
  border-bottom:2px solid var(--border-mid);
  font-weight:bold;
  font-size:14px;
}

.content{padding:14px}

.group{
  padding:12px;
  margin-bottom:12px;
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
}

/* ===== TOGGLES ===== */
.switchRow{
  display:flex;
  gap:14px;
  flex-wrap:wrap;
  align-items:center;
}

.switchWrap{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:12px;
  font-weight:bold;
}

.switchLabelShort{min-width:20px;text-align:center}
.switchLabelLong{min-width:64px;text-align:center}

.switch{
  position:relative;
  width:50px;
  height:22px;
  cursor:pointer;
}

.switch input{
  position:absolute;
  inset:0;
  opacity:0;
  z-index:5;
}

.track,.knob{pointer-events:none}

.track{
  width:100%;
  height:100%;
  background:var(--track);
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
}

.knob{
  position:absolute;
  top:2px;
  left:2px;
  width:16px;
  height:16px;
  background:var(--knob);
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
  transition:left .12s linear;
}
.switch input:checked ~ .knob{ left:30px }

/* ===== LABELS / INPUTS ===== */
.label{
  font-size:13px;
  font-weight:bold;
  margin-bottom:6px;
}

small{
  font-size:12px;
  font-weight:bold;
}

input{
  width:100%;
  padding:12px;
  font-size:16px;
  border:2px solid;
  border-color:var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
  background:var(--field);
  font-family:"MS Sans Serif", Tahoma, sans-serif;
  text-align:center;
}

input:focus{
  outline:2px dotted #000;
  outline-offset:-6px;
}

/* ===== TIME ===== */
.timeRow{
  display:flex;
  gap:6px;
  align-items:center;
}

.timeBox{flex:1}

.colon{
  font-weight:bold;
  font-size:18px;
  padding-top:4px;
  user-select:none;
}

/* ===== DISTANCE DROPDOWN ===== */
.labelRow{
  display:flex;
  align-items:center;
  gap:6px;
  margin-bottom:6px;
}

.arrowBtn{
  width:18px;
  height:18px;
  background:var(--panel);
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  font-size:9px;
}

.dropdown{position:relative}

.dropdownMenu{
  position:absolute;
  top:22px;
  left:0;
  background:var(--panel);
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
  box-shadow:1px 1px 0 #000;
  display:none;
  z-index:10;
  min-width:150px;
}

.dropdownMenu button{
  width:100%;
  padding:6px 10px;
  font-size:12px;
  font-weight:bold;
  background:var(--panel);
  border:none;
  text-align:left;
  cursor:pointer;
}
.dropdownMenu button:hover{background:#b0b0b0}

/* ===== OUTPUT ===== */
.output{
  padding:12px;
  background:#b8b8b8;
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.value{
  font-size:22px;
  font-weight:bold;
  background:#d0d0d0;
  padding:6px 10px;
  border:2px solid;
  border-color:var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
  min-width:190px;
  text-align:center;
}

button.clear{
  width:100%;
  padding:12px;
  margin-top:12px;
  font-weight:bold;
  background:var(--panel);
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
  box-shadow:1px 1px 0 #000;
  cursor:pointer;
}
button.clear:active{transform:translate(1px,1px)}

/* ===== MODAL (Win95 style) ===== */
.modalOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.25);
  display:none;
  align-items:center;
  justify-content:center;
  padding:16px;
  z-index:9999;
}

.modal{
  width:min(360px, 100%);
  background:var(--panel);
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
  box-shadow:1px 1px 0 #000;
}

.modalTitlebar{
  padding:8px 10px;
  background:#a0a0a0;
  border-bottom:2px solid var(--border-mid);
  font-weight:bold;
  font-size:13px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.modalBody{
  padding:12px;
  font-size:13px;
}

.modalActions{
  padding:12px;
  padding-top:0;
}

.modalBtn{
  width:100%;
  padding:10px;
  font-weight:bold;
  background:var(--panel);
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
  box-shadow:1px 1px 0 #000;
  cursor:pointer;
}
.modalBtn:active{transform:translate(1px,1px)}

.xBtn{
  width:22px;
  height:22px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--panel);
  border:2px solid;
  border-color:var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
  cursor:pointer;
  font-size:12px;
  line-height:1;
}
.xBtn:active{
  border-color:var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
}
</style>
</head>

<body>

<!-- ✅ HOME NAV -->
<div class="menu-buttons">
  <button class="navBtn" onclick="location.href='personal'">Home</button>
</div>

<!-- ===== MODAL ===== -->
<div class="modalOverlay" id="modalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal">
    <div class="modalTitlebar">
      <span id="modalTitle">Error</span>
      <button class="xBtn" id="modalX" aria-label="Close">×</button>
    </div>
    <div class="modalBody" id="modalMsg">Seconds and minutes must be 00–59.</div>
    <div class="modalActions">
      <button class="modalBtn" id="modalClose">Close</button>
    </div>
  </div>
</div>

<div class="win95">
  <div class="titlebar">Pace Calculator</div>
  <div class="content">

    <div class="group">
      <div class="label">Options</div>
      <div class="switchRow">
        <div class="switchWrap">
          <span class="switchLabelShort">Km</span>
          <label class="switch">
            <input type="checkbox" id="unitToggle">
            <div class="track"></div>
            <div class="knob"></div>
          </label>
          <span class="switchLabelShort">Mile</span>
        </div>

        <div class="switchWrap">
          <span class="switchLabelLong">Pace</span>
          <label class="switch">
            <input type="checkbox" id="treadToggle">
            <div class="track"></div>
            <div class="knob"></div>
          </label>
          <span class="switchLabelLong">Treadmill</span>
        </div>
      </div>
    </div>

    <div class="group">
      <div class="label">Time</div>
      <small>Hours : Minutes : Seconds</small>

      <div class="timeRow" style="margin-top:8px;">
        <div class="timeBox">
          <input type="text" id="hrs" maxlength="2" inputmode="numeric" pattern="[0-9]*">
        </div>
        <div class="colon">:</div>
        <div class="timeBox">
          <input type="text" id="min" maxlength="2" inputmode="numeric" pattern="[0-9]*">
        </div>
        <div class="colon">:</div>
        <div class="timeBox">
          <input type="text" id="sec" maxlength="2" inputmode="numeric" pattern="[0-9]*">
        </div>
      </div>
    </div>

    <div class="group">
      <div class="dropdown">
        <div class="labelRow">
          <div class="label">Distance</div>
          <div class="arrowBtn" id="arrow">▼</div>
        </div>

        <div class="dropdownMenu" id="menu">
          <button data-km="1">1 km</button>
          <button data-km="5">5 km</button>
          <button data-km="10">10 km</button>
          <button data-km="21.0975">Half Marathon</button>
          <button data-km="42.195">Marathon</button>
        </div>
      </div>

      <small id="distLabel">Kilometres</small>
      <input type="text" id="dist" inputmode="decimal">
    </div>

    <div class="output">
      <div id="resultLabel">Pace</div>
      <div class="value" id="result">--</div>
    </div>

    <button class="clear" id="clear">Clear</button>

  </div>
</div>

<script>
const hrs = document.getElementById("hrs");
const min = document.getElementById("min");
const sec = document.getElementById("sec");
const dist = document.getElementById("dist");

const unitToggle = document.getElementById("unitToggle");
const treadToggle = document.getElementById("treadToggle");

const result = document.getElementById("result");
const resultLabel = document.getElementById("resultLabel");
const distLabel = document.getElementById("distLabel");

const arrow = document.getElementById("arrow");
const menu = document.getElementById("menu");
const clearBtn = document.getElementById("clear");

/* ===== Modal ===== */
const modalOverlay = document.getElementById("modalOverlay");
const modalClose = document.getElementById("modalClose");
const modalX = document.getElementById("modalX");
const modalMsg = document.getElementById("modalMsg");

function showError(msg){
  modalMsg.textContent = msg;
  modalOverlay.style.display = "flex";
  if (navigator.vibrate) navigator.vibrate([20,40,20]);
  modalClose.focus();
}

function closeModal(){
  modalOverlay.style.display = "none";
}

modalClose.addEventListener("click", closeModal);
modalX.addEventListener("click", closeModal);
modalOverlay.addEventListener("click", (e)=>{
  if(e.target === modalOverlay) closeModal();
});
document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape" && modalOverlay.style.display === "flex") closeModal();
});

/* ===== helpers ===== */
function buzz(ms=10){
  if (navigator.vibrate) navigator.vibrate(ms);
}
function two(el){
  el.value = el.value.replace(/\D/g,"").slice(0,2);
  if (el.value.length === 1) el.value = "0" + el.value;
}

/* Lock minutes/seconds to 00–59 (hard lock + modal on overflow) */
function lockTo59(el){
  const raw = el.value;
  el.value = el.value.replace(/\D/g,"").slice(0,2);

  if (el.value === "") return;

  let n = parseInt(el.value, 10);
  if (!Number.isFinite(n)) { el.value = ""; return; }

  if (n > 59){
    el.value = "59";
    showError("Minutes and seconds must be between 00 and 59.");
    return;
  }

  // pad to 2 digits on blur / enter
  if (raw.length >= 1) el.value = String(n).padStart(2,"0");
}

/* ===== ENTER → NEXT & CLEAR NEXT ===== */
const order = [hrs, min, sec, dist];
order.forEach((el,i)=>{
  el.addEventListener("keydown", e=>{
    if(e.key === "Enter"){
      e.preventDefault();

      if(el === min || el === sec){
        lockTo59(el);
      } else if (el === hrs){
        two(el);
      }

      const next = order[i+1];
      if(next){
        next.value = "";
        next.focus();
        buzz();
      }
      calc();
    }
  });
});

/* Live typing: hard lock mins/sec */
[min, sec].forEach(el=>{
  el.addEventListener("input", ()=>{
    // keep only digits, max 2 chars
    const before = el.value;
    el.value = el.value.replace(/\D/g,"").slice(0,2);
    if (el.value !== before) buzz(6);

    if(el.value.length === 2){
      const n = parseInt(el.value,10);
      if (Number.isFinite(n) && n > 59){
        el.value = "59";
        showError("Minutes and seconds must be between 00 and 59.");
      }
    }
    calc();
  });

  el.addEventListener("blur", ()=>{
    if(el.value === "") return;
    lockTo59(el);
    calc();
  });
});

/* Hours: only digits, pad on blur */
hrs.addEventListener("input", ()=>{
  const before = hrs.value;
  hrs.value = hrs.value.replace(/\D/g,"").slice(0,2);
  if (hrs.value !== before) buzz(6);
  calc();
});
hrs.addEventListener("blur", ()=>{ if(hrs.value!=="") two(hrs); calc(); });

/* Distance: allow digits + one dot */
dist.addEventListener("input", ()=>{
  let v = dist.value.replace(/[^0-9.,]/g,"").replace(/,/g,".");
  const parts = v.split(".");
  if (parts.length > 2) v = parts[0] + "." + parts.slice(1).join("");
  dist.value = v;
  calc();
});

/* Dropdown */
arrow.onclick = ()=> menu.style.display = menu.style.display==="block" ? "none" : "block";
document.addEventListener("click",e=>{
  if(!arrow.contains(e.target)&&!menu.contains(e.target)) menu.style.display="none";
});
menu.querySelectorAll("button").forEach(btn=>{
  btn.onclick=()=>{
    dist.value = btn.dataset.km;
    menu.style.display="none";
    buzz(12);
    calc();
  };
});

/* Toggles */
unitToggle.addEventListener("change", ()=>{ buzz(12); calc(); });
treadToggle.addEventListener("change", ()=>{ buzz(12); calc(); });

/* Calc */
function calc(){
  distLabel.textContent = unitToggle.checked ? "Miles" : "Kilometres";

  const h = parseInt(hrs.value,10);
  const m = parseInt(min.value,10);
  const s = parseInt(sec.value,10);

  const hh = Number.isFinite(h) ? h : 0;
  const mm = Number.isFinite(m) ? m : 0;
  const ss = Number.isFinite(s) ? s : 0;

  const d = parseFloat(String(dist.value).replace(/,/g,"."));
  const totalSeconds = (hh * 3600) + (mm * 60) + ss;

  if (!Number.isFinite(d) || d <= 0 || totalSeconds <= 0){
    result.textContent="--";
    resultLabel.textContent = treadToggle.checked ? "Treadmill speed" : "Pace";
    return;
  }

  if (treadToggle.checked){
    const speed = (d / totalSeconds) * 3600;
    resultLabel.textContent="Treadmill speed";
    result.textContent = `${speed.toFixed(1)} ${unitToggle.checked ? "mph" : "km/h"}`;
    return;
  }

  const paceSeconds = totalSeconds / d;
  let paceMin = Math.floor(paceSeconds / 60);
  let paceSec = Math.round(paceSeconds - paceMin * 60);
  if (paceSec === 60){ paceMin += 1; paceSec = 0; }

  resultLabel.textContent="Pace";
  result.textContent = `${paceMin}:${String(paceSec).padStart(2,"0")} /${unitToggle.checked ? "mi" : "km"}`;
}

/* Clear */
clearBtn.onclick=()=>{
  hrs.value=min.value=sec.value=dist.value="";
  result.textContent="--";
  hrs.focus();
  buzz(14);
};

calc();
</script>

</body>
</html>
